<!DOCTYPE html>

<html>
	<head>
		<title>BCIT MAPS</title>
		<!--Include Firebase related things -->
		<!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
		<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>

		<!-- Add Firebase products that you want to use -->
		<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
		<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-firestore.js"></script>
		<script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
		<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
        
        <link href="json/jquery-ui.css" rel="stylesheet">
        <!--<script type="text/javascript" src="jquery-3.4.1.min.js"></script>-->
        <script src="json/external/jquery/jquery.js"></script>
        <script src="json/jquery-ui.js"></script>
        <script src="mask.js"></script>
        
        <link rel="stylesheet" href="mainstyles.css">

		<script>
		  // Your web app's Firebase configuration
		  var firebaseConfig = {
			apiKey: "AIzaSyCpjvd1ZUJyO0MU1nhD39w9AWF2b8UtemY",
			authDomain: "oct31-c298a.firebaseapp.com",
			databaseURL: "https://oct31-c298a.firebaseio.com",
			projectId: "oct31-c298a",
			storageBucket: "oct31-c298a.appspot.com",
			messagingSenderId: "635372216945",
			appId: "1:635372216945:web:caad77434c91d0c9de31d0"
		  };
		  // Initialize Firebase
		  firebase.initializeApp(firebaseConfig);
            var db = firebase.firestore();
		</script>
        
        
        <!-- Bootstrap for Mobile-first, and JQuery -->
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        
        
        
	</head>
	<body>
        

        
        
        <div id="phone" class="closeLogin" style="width: 360px; height: 640px; background-color: #B6D06B">

            <div id = "setlocationdiv">
                <h2 id = "currenttext">CLICK YOUR <br>CURRENT POSITION</h2>
            </div>

            <div id = "setdestinationdiv">
                <input id = "destinationsearch" type="text" placeholder="DESTINATION">
                <div id="mostsearcheddiv">

                </div>
            </div>
            
            <!-- <div id="topBar"> -->
                <!-- <div id="mapposition"> -->
                    <!-- Map Position:<br>x 0.00<br>y 0.00 -->
                <!-- </div> -->

               
                <input type="image" id ="zoominbutton" src="https://dummyimage.com/50x50/B6D06B&text=&plus;/"
                style="border-radius: 50%;" onclick="ZoomIn()">

                <input type="image" id ="zoomoutbutton" src="https://dummyimage.com/50x50/B6D06B&text=&#43;;" 
                style="border-radius: 50%;" onclick="ZoomOut()">

                    <!-- <button onclick="ZoomIn()" id="zoominbutton">+</button> -->
                    <!-- <button onclick="ZoomOut()" id="zoomoutbutton">-</button> -->
                
                <!-- <div class="dropdown">
                    <button onclick="myFunction()" class="droploginbtn">Login</button>
                    <div id="myDropdown" class="dropdown-content">
                        <a href="#logindropper">
                            <div id="firebaseui-auth-container"></div>
                            <div id="loader">Loading...</div>
                        </a>
                    </div>
                </div> -->
            <!-- </div> -->
            
            
            
            <!-- <div class="search-group">
                    <div class="search-group-prepend">
                        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">History</button>
                        <div class="dropdown-menu">
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                    </div>
                </div>
                <input id="user-search-location" type="text" class="form-control" aria-label="Text input with dropdown button">
            </div>
            <button id="search-button" type="button" class="btn btn-primary">&#62;</button> -->
            
            <div class = "searchcontainer">

                <img id = "searchicon" src="search_icons.JPG" width="12px">

                <div class = "searchform">

                    <div id = "currentlocation">
                        CURRENT LOCATION
                    </div>
                    

                </div>

                <div id = "line">
                </div>

                <div class = "searchform">

                    <div id = "currentdestination">
                        DESTINATION
                    </div>
                </div>

             </div>
            
            
            <div class="bottomfooter">
            </div>
            
            <div class="closeLogin" id="map-container">
                <img id="drag-image" src="map_ver2.jpg" />
                <canvas id="myCanvas" width="360" height="640" style="border:1px solid #000;"></canvas>
            </div>
            
            </div>
<!--      fphone -->
        
        
        <script>
			// Initialize the FirebaseUI Widget using Firebase.
			var ui = new firebaseui.auth.AuthUI(firebase.auth());

			var uiConfig = {
			  callbacks: {
				signInSuccessWithAuthResult: function(authResult, redirectUrl) {
				  // User successfully signed in.
				  // Return type determines whether we continue the redirect automatically
				  // or whether we leave that to developer to handle.
				  return true;
				},
				uiShown: function() {
				  // The widget is rendered.
				  // Hide the loader.
				  document.getElementById('loader').style.display = 'none';
				}
			  },
			  // Will use popup for IDP Providers sign-in flow instead of the default, redirect.
			  signInFlow: 'popup',
			  signInSuccessUrl: 'main.html',
			  signInOptions: [
				// Leave the lines as is for the providers you want to offer your users.
				//firebase.auth.GoogleAuthProvider.PROVIDER_ID,
				//firebase.auth.FacebookAuthProvider.PROVIDER_ID,
				//firebase.auth.TwitterAuthProvider.PROVIDER_ID,
				//firebase.auth.GithubAuthProvider.PROVIDER_ID,
				firebase.auth.EmailAuthProvider.PROVIDER_ID,
				//firebase.auth.PhoneAuthProvider.PROVIDER_ID
			  ],
			  // Terms of service url.
			  tosUrl: 'main.html',
			  // Privacy policy url.
			  privacyPolicyUrl: 'main.html'
			};

			// The start method will wait until the DOM is loaded.
			ui.start('#firebaseui-auth-container', uiConfig);

		</script>
        
        
        
        
        <script>
            
            var staticX = 1*39;
            var staticY = 1*39;
            var staticBuilding = '1';


            // window.addEventListener('load', function() {

            // var user = firebase.auth().currentUser;
            //    var name, uid;

            //   if (user != null){
            //     name = user.displayName;
            //     uid = user.uid;

            //     $('.bottomfooter').html(name);
            //     }

            //     });

            function displayTimer() {
                
                var user = firebase.auth().currentUser;
                var name, uid;

                if (user != null){
                name = user.displayName;
                uid = user.uid;

                $('.bottomfooter').html("Hey " + name + "!");
                
                
                getSearchInformation();
                sortSearchArrays();
                printSearchArrays();
                }
                setTimeout(displayTimer, 500);
                

            }
            
            displayTimer();
            
            
            
            //1 = sw1
            //2 = sw2
            //3 = sw3
            //5 = sw5
            //9 = sw9
            //b = se2
            //e = se12
            //g = se10
            //h = se14
            //i = se16
            var validbuilding = ['sw1', 'sw2', 'sw3', 'sw5', 'sw9', 'se2', 'se12', 'se10', 'se14', 'se16'];
            var validbuildingCode = ['1', '2', '3', '5', '9', 'b', 'e', 'g', 'h', 'i'];
            var input = document.getElementById("destinationsearch");
            input.addEventListener("keyup", function(event) {
            if (event.keyCode === 13) {

                event.preventDefault();
                // javascript:alert($('#destinationsearch').val());

                var iii;
                var userinput = $('#destinationsearch').val();
                var foundbuilding = false;

                for (iii = 0; iii < validbuilding.length; iii++) {
                    
                    // alert("[" + userinput + "]" + "[" + validbuilding[iii] + "]");

                    if (userinput == validbuilding[iii]){
                        FindPath(staticX, staticY, validbuildingCode[iii]);
                        DrawPathFindingUpdate();
                        foundbuilding = true;
                        //$('#setdestinationdiv').css('display', 'none');
                        // alert("works wee");
                        incSearchLocation(userinput);
                    }
                }
                if (!foundbuilding){
                    alert("This is not a valid building.");
                }
            }
            });





            $('#currentlocation').on('mousedown', function(event) {
                $('#setlocationdiv').css("display", "block");
            });


            $('#currentdestination').on('mousedown', function(event) {
                $('#setdestinationdiv').css("display", "block");
            });
            

            //when the search button is clicked
            // $('#search-button').click(function(){
            //     incSearchLocation($('#user-search-location').val());
            // });

            
















            
            //arrays to keep track of the users searches
            var CURRENTsearchLocation = [];
            var CURRENTsearchAmount = [];
            var CURRENTsearchTimeStamp = [];
            
            //update their searches
            getSearchInformation();
            
            //getSearchInformation gets all of the user's search information off of the database
            function getSearchInformation() {
                var user = firebase.auth().currentUser;
                
                if( user != null){
                    //$("#mapposition").html(user.uid);
                


                    db.collection(user.uid) // add to this nesting if needed
                    .get()                  // getting a collection of documents
                    .then(function(snap){
                        // console.log(snap); // collection of documents
                        var iii=0;
                        snap.forEach(function(doc){ // iterate thru collections
                            // console.log(doc)
                            CURRENTsearchLocation[iii] = doc.data().location;
                            CURRENTsearchAmount[iii] = doc.data().amount;
                            CURRENTsearchTimeStamp[iii] = doc.data().timeStamp;
                            iii+=1;
                        });
                        //console.log(CURRENTsearchLocation);
                        //console.log(CURRENTsearchAmount);
                    });
                }
            }

            
            //incSearchLocation increases the increases the times the user has searched a location on the database
            //building is the string of the building's name
            function incSearchLocation(building) {
                var iii;
                
                

                var user = firebase.auth().currentUser;
                
                if( user != null){
                    var curDate = new Date();
                    var curTime = curDate.getTime();


                    //loop through all of the user's searches
                    var loopFoundLocation=false;
                    for(iii=0; iii<CURRENTsearchLocation.length; iii+=1) {
                        //check if they have searched this location before
                        if(CURRENTsearchLocation[iii]==building){
                            //if they have increase the search's frequency by 1
                            var docData = {
                                location: CURRENTsearchLocation[iii],
                                amount: (CURRENTsearchAmount[iii]+1),
                                timeStamp: curTime
                            };
                            db.collection(user.uid).doc(CURRENTsearchLocation[iii]).set(docData);
                            
                            loopFoundLocation=true;
                        } 
                    }
                    
                    //the user has never searched this place before... keep track of it
                    if(!loopFoundLocation){
                        var docData = {
                            location: building,
                            amount: (1),
                            timeStamp: curTime
                        };
                        db.collection(user.uid).doc(building).set(docData);
                    }
                    
                    //update their searches
                    getSearchInformation();
                    sortSearchArrays();
                    printSearchArrays();
                }



            }
            
            
            //sortSearchArrays sorts both of the search arrays
            //the largest number goes to index 0
            //the smallest number goes to the last index
            function sortSearchArrays() {
                var didChange=true;
                //keep comparing them until they are in order
                while(didChange){
                    didChange=false;
                    
                    var iii;
                    //loop from start to end
                    for(iii=0;iii<CURRENTsearchLocation.length-1;iii+=1) {
                        //compare the index's next to each other
                        if(CURRENTsearchAmount[iii]<CURRENTsearchAmount[iii+1]){
                            //wrong order: swap them
                            let tempAmount = CURRENTsearchAmount[iii];
                            let tempLocation = CURRENTsearchLocation[iii];
                            let tempTimeStamp = CURRENTsearchTimeStamp[iii];
                            
                            CURRENTsearchAmount[iii]=CURRENTsearchAmount[iii+1];
                            CURRENTsearchLocation[iii]=CURRENTsearchLocation[iii+1];
                            CURRENTsearchTimeStamp[iii]=CURRENTsearchTimeStamp[iii+1];
                            CURRENTsearchAmount[iii+1]=tempAmount;
                            CURRENTsearchLocation[iii+1]=tempLocation;
                            CURRENTsearchTimeStamp[iii+1]=tempTimeStamp;
                            didChange=true;
                        }
                    }
                }
            }
            
            //print out all of the users searches to the debug window
            function printSearchArrays() {
                var iii;
                //var writeString="";
                //$('#debugDiv').html("");
                //loop from start to end
                $("#mostsearcheddiv").empty();
                for(iii=0;iii<CURRENTsearchLocation.length;iii+=1) {
                    //$('#debugDiv').html($('#debugDiv').html()+"Location: "+CURRENTsearchLocation[iii]+"<br>"+"Frequency:"+CURRENTsearchAmount[iii]+"<br>");
                    //writeString+="Location: "+CURRENTsearchLocation[iii]+"<br>"+"Frequency:"+CURRENTsearchAmount[iii]+"<br>";
                    //mostsearcheddiv
                    $( "#mostsearcheddiv").append('<div class="searchhistorydiv">'+CURRENTsearchLocation[iii]+'</div>');
                    
                }
                //$('#debugDiv').html(writeString);
                
            }
            
            
















            
            
            
            
            ///////////////////////////////////////////////////////////////////////////////
            //DRAGGING AROUND THE IMAGE
            ///////////////////////////////////////////////////////////////////////////////
            $("#drag-image").css({ top: 0 + 'px', left: 0 + 'px' });
            var _DRAGGGING_STARTED = 0;
            var _LAST_MOUSEMOVE_POSITION = { x: null, y: null };
            var _DIV_OFFSET = $('#map-container').offset();
            var _CONTAINER_WIDTH = $("#map-container").outerWidth();
            var _CONTAINER_HEIGHT = $("#map-container").outerHeight();
            var _IMAGE_WIDTH;
            var _IMAGE_HEIGHT;
            var _IMAGE_LOADED = 0;
            var zoomFactor = 1;
            var zoomPerTimer = 2;
            var mapStartingWidth;
            var mapStartingHeight;

            // Check whether image is cached or wait for the image to load 
            // This is necessary before calculating width and height of the image
            if($('#drag-image').get(0).complete) {
                ImageLoaded();
            }
            else {
                $('#drag-image').on('load', function() {
                    ImageLoaded();
                });
            }

            // Image is loaded
            function ImageLoaded() {
                _IMAGE_WIDTH = $("#drag-image").width();
                _IMAGE_HEIGHT = $("#drag-image").height();
                mapStartingWidth = _IMAGE_WIDTH;
                mapStartingHeight = _IMAGE_HEIGHT;
                _IMAGE_LOADED = 1;
            }

















    



            ///////////////////////////////////////////////////////////////////////////////
            //TOUCH DRAG FOR MOBILE
            ///////////////////////////////////////////////////////////////////////////////

            $('#map-container').bind('touchstart', function(jQueryEvent) {

                jQueryEvent.preventDefault();
                var event = window.event;
                // console.log('x=' + event.touches[0].pageX + ' y= ' + event.touches[0].pageY);


                /* Image should be loaded before it can be dragged */
                if(_IMAGE_LOADED == 1) { 
                    _DRAGGGING_STARTED = 1;

                    /* Save mouse position */
                    _LAST_MOUSE_POSITION = { x:  event.touches[0].pageX - _DIV_OFFSET.left, y: event.touches[0].pageY - _DIV_OFFSET.top };
                }
            });

            $('#map-container').bind('touchend', function(jQueryEvent) {
                jQueryEvent.preventDefault();
                _DRAGGGING_STARTED = 0;
            });

            $('#map-container').bind('touchmove', function(jQueryEvent) {

                jQueryEvent.preventDefault();
                var event = window.event;
                // console.log('x=' + event.touches[0].pageX + ' y= ' + event.touches[0].pageY);

                var current_mouse_position = { x: event.touches[0].pageX - _DIV_OFFSET.left, y: event.touches[0].pageY - _DIV_OFFSET.top };
                var img_top = parseInt($("#drag-image").css('top'), 10);
                var img_left = parseInt($("#drag-image").css('left'), 10);
                
                if(_DRAGGGING_STARTED == 1) {
                    var change_x = current_mouse_position.x - _LAST_MOUSE_POSITION.x;
                    var change_y = current_mouse_position.y - _LAST_MOUSE_POSITION.y;

                    /* Save mouse position */
                    _LAST_MOUSE_POSITION = current_mouse_position;

                    var img_top_new = img_top + change_y;
                    var img_left_new = img_left + change_x;

                    /* Validate top and left do not fall outside the image, otherwise white space will be seen */
                    if(img_top_new > 0)
                        img_top_new = 0;
                    if(img_top_new < (_CONTAINER_HEIGHT - _IMAGE_HEIGHT))
                        img_top_new = _CONTAINER_HEIGHT - _IMAGE_HEIGHT;

                    if(img_left_new > 0)
                        img_left_new = 0;
                    if(img_left_new < (_CONTAINER_WIDTH - _IMAGE_WIDTH))
                        img_left_new = _CONTAINER_WIDTH - _IMAGE_WIDTH;

                    $("#drag-image").css({ top: img_top_new + 'px', left: img_left_new + 'px' });
                }
                
                /* Save mouse position */
                _LAST_MOUSE_POSITION = current_mouse_position;
                
                var change_x = current_mouse_position.x - _LAST_MOUSE_POSITION.x;
                var change_y = current_mouse_position.y - _LAST_MOUSE_POSITION.y;
                
                //calculate the mouse position on the map
                var dragImageLeft = parseFloat(document.getElementById("drag-image").style.left);
                var dragImageTop = parseFloat(document.getElementById("drag-image").style.top);
                
                var mousePosOnMap = { x: (current_mouse_position.x - dragImageLeft)/zoomFactor, y: (current_mouse_position.y - dragImageTop)/zoomFactor};
                
                //display the mouse pos on the map
                // $("#mapposition").html('Map Position:<br>x: ' + mousePosOnMap.x.toFixed(2) + '<br>y: ' + mousePosOnMap.y.toFixed(2));
               
                var user = firebase.auth().currentUser;
                
                if( user != null){
                    $("#mapposition").html(user.uid);
                }

                DrawPathFindingUpdate();
            });
























                







            ///////////////////////////////////////////////////////////////////////////////
            //MOUSE CONTROLS FOR DESKTOP
            ///////////////////////////////////////////////////////////////////////////////

            $('#map-container').on('mousedown', function(event) {
                /* Image should be loaded before it can be dragged */
                if(_IMAGE_LOADED == 1) { 
                    _DRAGGGING_STARTED = 1;

                    /* Save mouse position */
                    _LAST_MOUSE_POSITION = { x: event.pageX - _DIV_OFFSET.left, y: event.pageY - _DIV_OFFSET.top };
                }
            });

            $('#map-container').on('mouseup', function() {
                _DRAGGGING_STARTED = 0;
            });

            $('#map-container').on('mousemove', function(event) {
                var current_mouse_position = { x: event.pageX - _DIV_OFFSET.left, y: event.pageY - _DIV_OFFSET.top };
                var img_top = parseInt($("#drag-image").css('top'), 10);
                var img_left = parseInt($("#drag-image").css('left'), 10);
                
                if(_DRAGGGING_STARTED == 1) {
                    var change_x = current_mouse_position.x - _LAST_MOUSE_POSITION.x;
                    var change_y = current_mouse_position.y - _LAST_MOUSE_POSITION.y;

                    /* Save mouse position */
                    _LAST_MOUSE_POSITION = current_mouse_position;

                    var img_top_new = img_top + change_y;
                    var img_left_new = img_left + change_x;

                    /* Validate top and left do not fall outside the image, otherwise white space will be seen */
                    if(img_top_new > 0)
                        img_top_new = 0;
                    if(img_top_new < (_CONTAINER_HEIGHT - _IMAGE_HEIGHT))
                        img_top_new = _CONTAINER_HEIGHT - _IMAGE_HEIGHT;

                    if(img_left_new > 0)
                        img_left_new = 0;
                    if(img_left_new < (_CONTAINER_WIDTH - _IMAGE_WIDTH))
                        img_left_new = _CONTAINER_WIDTH - _IMAGE_WIDTH;

                    $("#drag-image").css({ top: img_top_new + 'px', left: img_left_new + 'px' });
                }
                
                /* Save mouse position */
                _LAST_MOUSE_POSITION = current_mouse_position;
                
                var change_x = current_mouse_position.x - _LAST_MOUSE_POSITION.x;
                var change_y = current_mouse_position.y - _LAST_MOUSE_POSITION.y;
                
                //calculate the mouse position on the map
                var dragImageLeft = parseFloat(document.getElementById("drag-image").style.left);
                var dragImageTop = parseFloat(document.getElementById("drag-image").style.top);
                
                var mousePosOnMap = { x: (current_mouse_position.x - dragImageLeft)/zoomFactor, y: (current_mouse_position.y - dragImageTop)/zoomFactor};
                
                //display the mouse pos on the map
                // $("#mapposition").html('Map Position:<br>x: ' + mousePosOnMap.x.toFixed(2) + '<br>y: ' + mousePosOnMap.y.toFixed(2));
               
                var user = firebase.auth().currentUser;
                
                if( user != null){
                    $("#mapposition").html(user.uid);
                }

                DrawPathFindingUpdate();
            });









            //for div
            $('#setlocationdiv').on('mousedown', function(event) {
                
                var current_mouse_position = { x: event.pageX - _DIV_OFFSET.left, y: event.pageY - _DIV_OFFSET.top };
                var dragImageLeft = parseFloat(document.getElementById("drag-image").style.left);
                var dragImageTop = parseFloat(document.getElementById("drag-image").style.top);
                var mousePosOnMap = { x: (current_mouse_position.x - dragImageLeft)/zoomFactor, y: (current_mouse_position.y - dragImageTop)/zoomFactor};
             
                var mapIndexX = Math.floor(mousePosOnMap.x/39);
                var mapIndexY = Math.floor(mousePosOnMap.y/39);

                if (mask[mapIndexY][mapIndexX] == ' '){
                    
                    FindPath(mousePosOnMap.y, mousePosOnMap.x, staticBuilding);
                    $('#setlocationdiv').css("display", "none");
                    DrawPathFindingUpdate();
                }
            });

            
            
            ///////////////////////////////////////////////////////////////////////////////
            //ZOOM IN
            ///////////////////////////////////////////////////////////////////////////////
            function ZoomIn() {
                //limmit the max zoom in amount
                if(zoomFactor * 2 <= 16) {
                    var preWidth = document.getElementById("drag-image").clientWidth;
                    var preHeight = document.getElementById("drag-image").clientHeight;

                    zoomFactor *= 2;
                    var postWidth = mapStartingWidth * zoomFactor;
                    var postHeight = mapStartingHeight * zoomFactor;
                    _IMAGE_WIDTH = postWidth;
                    _IMAGE_HEIGHT = postHeight;
                    document.getElementById("drag-image").style.width = postWidth + 'px';
                    document.getElementById("drag-image").style.height = postHeight + 'px';

                    var dragImageLeft = parseFloat(document.getElementById("drag-image").style.left);
                    var dragImageTop = parseFloat(document.getElementById("drag-image").style.top);
                    dragImageLeft *= 2;
                    dragImageTop *= 2;
                    dragImageLeft -= _CONTAINER_WIDTH / 2;
                    dragImageTop -= _CONTAINER_HEIGHT / 2;
                    $("#drag-image").css({ top: dragImageTop + 'px', left: dragImageLeft + 'px' });
                }
                DrawPathFindingUpdate();
            }
            

            ///////////////////////////////////////////////////////////////////////////////
            //ZOOM OUT
            ///////////////////////////////////////////////////////////////////////////////
            function ZoomOut() {
                //limmit the max zoom out amount
                if(zoomFactor / 2 >= 0.25) {
                    var preWidth = document.getElementById("drag-image").clientWidth;
                    var preHeight = document.getElementById("drag-image").clientHeight;

                    zoomFactor /= 2;
                    var postWidth = mapStartingWidth * zoomFactor;
                    var postHeight = mapStartingHeight * zoomFactor;
                    _IMAGE_WIDTH = postWidth;
                    _IMAGE_HEIGHT = postHeight;
                    document.getElementById("drag-image").style.width = postWidth + 'px';
                    document.getElementById("drag-image").style.height = postHeight + 'px';

                    var dragImageLeft = parseFloat(document.getElementById("drag-image").style.left);
                    var dragImageTop = parseFloat(document.getElementById("drag-image").style.top);
                    dragImageLeft += _CONTAINER_WIDTH / 2;
                    dragImageTop += _CONTAINER_HEIGHT / 2;
                    dragImageLeft /= 2;
                    dragImageTop /= 2;
                    
                    /* Validate top and left do not fall outside the image, otherwise white space will be seen */
                    if(dragImageTop > 0)
                        dragImageTop = 0;
                    if(dragImageTop < (_CONTAINER_HEIGHT - _IMAGE_HEIGHT))
                        dragImageTop = _CONTAINER_HEIGHT - _IMAGE_HEIGHT;

                    if(dragImageLeft > 0)
                        dragImageLeft = 0;
                    if(dragImageLeft < (_CONTAINER_WIDTH - _IMAGE_WIDTH))
                        dragImageLeft = _CONTAINER_WIDTH - _IMAGE_WIDTH;
                    
                    $("#drag-image").css({ top: dragImageTop + 'px', left: dragImageLeft + 'px' });
                }
                DrawPathFindingUpdate();
            }
            
            
            
            


            
            
            
            
            
            /* When the user clicks on the button, 
            toggle between hiding and showing the dropdown content */
            function myFunction() {
              document.getElementById("myDropdown").classList.toggle("show");
            }

            // Close the dropdown if the user clicks outside of it
            window.onclick = function(event) {
                //only close the drop down something is clicked away from it
                if ((event.target.matches('.closeLogin'))&&(!event.target.matches('.droploginbtn')))
                {
                    var dropdowns = document.getElementsByClassName("dropdown-content");
                    var i;
                    for (i = 0; i < dropdowns.length; i++) {
                        var openDropdown = dropdowns[i];
                        if (openDropdown.classList.contains('show')) {
                            openDropdown.classList.remove('show');
                        }
                    }
                }
            }
           
            
            
            
            //Multi D Array Creation
            function createArray(length) {
                var arr = new Array(length || 0),
                    i = length;

                if (arguments.length > 1) {
                    var args = Array.prototype.slice.call(arguments, 1);
                    while(i--) arr[length-1 - i] = createArray.apply(this, args);
                }

                return arr;
            }
            
            
            
            ///////////////////////////////////////////////////////////////////////////////
            //PATH FINDING
            ///////////////////////////////////////////////////////////////////////////////
            //1 = sw1
            //2 = sw2
            //3 = sw3
            //5 = sw5
            //9 = sw9
            //b = se2
            //e = se12
            //g = se10
            //h = se14
            //i = se16
            var solidWallCountX = 65 + 2;
            var solidWallCountY = 84 + 2;
            var foundLocationX = -1;
            var foundLocationY = -1;
            var loopCounter=0;
            var pathingArrayX = createArray(65,84);
            var pathingArrayY = createArray(65,84);
            function FindPath(startX, startY, findBuilding) {
                var iii;
                var fff;
                var xxx;
                var yyy;
                
                staticX = startX;
                staticY = startY;
                staticBuilding = findBuilding;

                foundLocationX = -1;
                foundLocationY = -1;
                
                //convert the map position to the tile position
                xxx = Math.floor(startX/39);
                yyy = Math.floor(startY/39);
                
                var newLocations = createArray(65,84);
                var canReachLocation = createArray(65,84);
                //var insideSolidWallExists = createArray(65,84);
                //var pathingArrayX = createArray(65,84);
                //var pathingArrayY = createArray(65,84);
                
                
                //reset all of them
                for (iii = 0; iii < solidWallCountX - 2; iii += 1)
                {
                    for (fff = 0; fff < solidWallCountY - 2; fff += 1)
                    {
                        newLocations[iii][fff] = false;
                        canReachLocation[iii][fff] = false;
                        pathingArrayX[iii][fff] = -1;
                        pathingArrayY[iii][fff] = -1;
                    }
                }

                //set the start location
                newLocations[xxx][yyy] = true;
                canReachLocation[xxx][yyy] = true;


                
                //loop through all the possiable target locations
                //set the default values
                var foundNoNewLocations = false;
                exitPathFindingLoop: {
                while (!foundNoNewLocations)
                {
                    loopCounter += 1;
                    foundNoNewLocations = true;
                    //loop through all the locations to find all of the new spots
                    for (iii = 0; iii < solidWallCountX - 2; iii += 1)
                    {
                        for (fff = 0; fff < solidWallCountY - 2; fff += 1)
                        {
                            //check for new locations
                            if (newLocations[iii][fff])
                            {
                                //check if the building we are looking for has been found
                                if(mask[iii][fff]==findBuilding)
                                {
                                    foundLocationX = iii;
                                    foundLocationY = fff;
                                    break exitPathFindingLoop;
                                }
                                
                                
                                //check for the left bound
                                if (iii > 0)
                                {
                                    if ((mask[iii-1][fff]!='x') && (!canReachLocation[iii - 1][fff]))
                                    {
                                        canReachLocation[iii - 1][fff] = true;
                                        newLocations[iii - 1][fff] = true;
                                        foundNoNewLocations = false;
                                        pathingArrayX[iii - 1][fff] = iii;
                                        pathingArrayY[iii - 1][fff] = fff;
                                    }
                                }

                                //check for the top bound
                                if (fff > 0)
                                {
                                    if ((mask[iii][fff-1]!='x') && (!canReachLocation[iii][fff - 1]))
                                    {
                                        canReachLocation[iii][fff - 1] = true;
                                        newLocations[iii][fff - 1] = true;
                                        foundNoNewLocations = false;
                                        pathingArrayX[iii][fff-1] = iii;
                                        pathingArrayY[iii][fff-1] = fff;
                                    }
                                }

                                //check for the right bound
                                if (iii < solidWallCountX - 2 - 1)
                                {
                                    if ((mask[iii+1][fff]!='x') && (!canReachLocation[iii + 1][fff]))
                                    {
                                        canReachLocation[iii + 1][fff] = true;
                                        newLocations[iii + 1][fff] = true;
                                        foundNoNewLocations = false;
                                        pathingArrayX[iii + 1][fff] = iii;
                                        pathingArrayY[iii + 1][fff] = fff;
                                    }
                                }

                                //check for the bottom bound
                                if (fff < solidWallCountY - 2 - 1)
                                {
                                    if ((mask[iii][fff+1]!='x') && (!canReachLocation[iii][fff + 1]))
                                    {
                                        canReachLocation[iii][fff + 1] = true;
                                        newLocations[iii][fff + 1] = true;
                                        foundNoNewLocations = false;
                                        pathingArrayX[iii][fff+1] = iii;
                                        pathingArrayY[iii][fff+1] = fff;
                                    }
                                }
                                //location has been dealt with
                                newLocations[iii][fff] = false;
                            }
                        }
                    }
                }
                }
                
            }
            
            
            
            
            
            
            var drawCounter=0;
            function DrawPathFindingUpdate(){
                //get canvas info
                var c = document.getElementById("myCanvas");
                var ctx = c.getContext("2d");
                var scaleAmount = 39*zoomFactor;
                
                
                //get the map offset
                var drawOffsetX = parseFloat(document.getElementById("drag-image").style.left);
                var drawOffsetY = parseFloat(document.getElementById("drag-image").style.top);
                
                
                //clear the canvas
                ctx.clearRect(0, 0, c.width, c.height);
                ctx.strokeStyle = "#0000ff";
                
                //starting location
                ctx.beginPath();
                var curDrawLocX = foundLocationX;
                var curDrawLocY = foundLocationY;
                ctx.moveTo(Math.round((curDrawLocY+0.5)*scaleAmount+drawOffsetX),Math.round((curDrawLocX+0.5)*scaleAmount+drawOffsetY));
                
                //loop until we reach the end
                while(pathingArrayX[curDrawLocX][curDrawLocY]!=-1)
                {
                    drawCounter+=1;
                    //draw a line to the current location
                    ctx.lineTo( Math.round((curDrawLocY+0.5)*scaleAmount+drawOffsetX),Math.round((curDrawLocX+0.5)*scaleAmount+drawOffsetY));
                    
                    //step forward one time
                    var newLocX=pathingArrayX[curDrawLocX][curDrawLocY];
                    var newLocY=pathingArrayY[curDrawLocX][curDrawLocY];
                    curDrawLocX=newLocX;
                    curDrawLocY=newLocY;
                }
                
                //done
                ctx.stroke();
                //document.getElementById("debugDiv").innerHTML=pathingArrayX[curDrawLocX][curDrawLocY]+" "+pathingArrayY[curDrawLocX][curDrawLocY];
                //document.getElementById("debugDiv").innerHTML=drawCounter;
                //document.getElementById("debugDiv").innerHTML=pathingArrayX[2][3]+" "+pathingArrayY[2][3];
            }
            
            
            
            
            
            
            
            
            
            
            FindPath(3*39, 40*39, '1');
            //document.getElementById("debugDiv").innerHTML+="x: " + foundLocationX + "<br>";
            //document.getElementById("debugDiv").innerHTML+="y: " + foundLocationY + "<br>";
            DrawPathFindingUpdate();
            //set the default zoom to 0.25
            ZoomOut();
            ZoomOut();
        </script>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <script>
        // Loop to display the elements of 2D array. 
for (var i = 0; i < 64; i++) { 
    for (var j = 0; j < 65; j++) 
  
    { 
        //document.getElementById("debugDiv").innerHTML+=mask[i][j];
    } 
    //document.getElementById("debugDiv").innerHTML+="<br>";
} 
        </script>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
		


	</body>


</html>